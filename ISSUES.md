# プロジェクトの問題点分析

このプロジェクトは、Vite + Reactで開発されたアプリケーションをWebサーバーなしの `file://` プロトコルで動作させるという、特殊な目的を持っています。その実現方法に起因する、いくつかの重大な問題点を以下にまとめます。

## 1. コードの二重管理と信頼できる情報源の欠如

**問題点:**
アプリケーションのロジックが、開発時に使用されるJSXファイル (`src/App.jsx`) と、ビルド時に `dist/index.html` へ直接埋め込まれるスクリプト (`postbuild-cdn-html.cjs` 内) の2箇所で、完全に独立して管理されています。

**リスク:**
- **メンテナンス性の著しい低下:** `src/App.jsx` を修正しても、ビルド成果物には反映されません。ビルドスクリプト内のハードコードされたロジックも手動で同期させる必要があり、修正漏れやバグの温床となります。
- **混乱の元:** 開発の「信頼できる唯一の情報源（Single Source of Truth）」が存在せず、どちらのコードが最新か、あるいは正しいのかが不明確になります。

---

## 2. 不適切なCDN依存関係

**問題点:**
ビルド後の `index.html` は、ReactおよびReactDOMをCDNから読み込みますが、そのURLが開発版 (`react.development.js`) にハードコードされています。

**リスク:**
- **パフォーマンスの低下:** 開発版ライブラリはデバッグ情報を含むためファイルサイズが大きく、プロダクション環境での利用には適していません。
- **バージョンの不整合:** `package.json` で管理されているバージョンとCDNのバージョンが連動していないため、意図しないバージョンのライブラリが使用される可能性があります。

---

## 3. 拡張性の低いアーキテクチャ

**問題点:**
アプリケーション全体をビルドスクリプト内で `React.createElement` を使って手書きするアプローチは、現状の単純なカウンターアプリだからこそ成り立っています。

**リスク:**
- **スケールしない:** コンポーネントの分割、外部ライブラリの利用、状態管理の導入など、アプリケーションが少しでも複雑になると、この手法は現実的ではなくなり、すぐに破綻します。
- **開発体験の悪化:** JSXの恩恵（可読性、書きやすさ）を完全に捨てており、開発効率が非常に悪いです。

---

## 4. CSSの不整合と欠落

**問題点:**
開発時とビルド時で適用されるCSSに差異があります。
- `postbuild-cdn-html.cjs` は `src/index.css` を読み込みますが、`src/App.css` は無視されます。
- 加えて、ビルドスクリプト内にも独自のCSSがハードコードされており、スタイルが重複・競合する可能性があります。

**リスク:**
- **表示の不一致:** 開発環境で確認したレイアウトと、ビルド後の成果物の表示が異なるという問題を引き起こします。

---

## 5. ビルドプロセスの脆弱性

**問題点:**
`postbuild-cdn-html.cjs` スクリプトには、ファイル読み込み（`fs.readFileSync`）や書き込み（`fs.writeFileSync`）に対するエラーハンドリングが存在しません。

**リスク:**
- **不安定なビルド:** ファイルパスの変更や読み込み失敗などが発生した場合、ビルドプロセス全体が不明瞭なエラーで失敗する可能性があります。

---

## 6. 【根本原因】開発版とビルド版の乖離

**問題点:**
上記の問題はすべて、この根本的な問題に集約されます。「開発時に見ていたものと、最終的にビルドされるものが全く違う」という点です。Viteによる強力な開発サーバーとモジュールバンドルの利点を、最終成果物では完全に捨て去っています。

**リスク:**
- **信頼性の欠如:** 開発環境でのテストや確認が、ビルド後の成果物の品質を保証しないため、プロジェクト全体の信頼性が著しく損なわれます。

## 提言

このアプローチを維持する場合、せめてビルドスクリプトが `src/App.jsx` を読み込み、Babel等でトランスパイルしてHTMLに埋め込むように修正することで、コードの二重管理問題は解決できます。しかし、より根本的には、このような特殊な要件を満たすための別のアーキテクチャ（例：Viteのライブラリモードの活用や、より目的に特化した静的サイトジェネレータの検討）を考慮することが望ましいです。
